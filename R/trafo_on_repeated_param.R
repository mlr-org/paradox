#' @title A helper to create trafo functions for repeated parameters.
#'
#' @description
#' A helper to create trafo functions for repeated parameters.
#'
#' @param fun [\code{function}]\cr
#'   A trafo function with the arguments x, tags
#' @param repeated_param_id [\code{character(1)}]\cr
#'   The id of the parameter the that is repeated_
#' @return function
#' @export
trafo_on_repeated_param = function(fun, repeated_param_id) {
  assert_function(fun, args = c("x", "tags"))
  assert_string(repeated_param_id)
  function(x, tags) {
    x = ensure_data_table(x)
    ind = names(which(map_lgl(tags, function(z) paste0(repeated_param_id, "_repeated") %in% z)))
    res = fun(x = x[, ind, with = FALSE], tags = tags)
    res = ensure_data_table(res, nrows = nrow(x))
    x[, (ind) := NULL]
    x[, (names(res)) := res]
    return(x)
  }
}
